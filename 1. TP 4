{"cells":[{"cell_type":"markdown","metadata":{"id":"vTG0ENr1tmZI"},"source":["# Data Acquisition \n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4772,"status":"ok","timestamp":1655574742936,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"prq7DBfHtndo","outputId":"aeae9109-0ce9-42eb-e187-1dbb2c345dab"},"outputs":[{"name":"stdout","output_type":"stream","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: lightfm in /usr/local/lib/python3.7/dist-packages (1.16)\n","Requirement already satisfied: scipy>=0.17.0 in /usr/local/lib/python3.7/dist-packages (from lightfm) (1.4.1)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from lightfm) (1.0.2)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from lightfm) (1.21.6)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from lightfm) (2.23.0)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (3.0.4)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (2.10)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (2022.6.15)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (1.24.3)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->lightfm) (1.1.0)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->lightfm) (3.1.0)\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')\n","!pip install lightfm"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"yR2-c7g2t0Ng"},"outputs":[],"source":["import pandas as pd"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"EmUIq2lXz1Jw"},"outputs":[],"source":["vistas=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/train.csv')\n","activos=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/metadata.csv',sep=\";\")"]},{"cell_type":"markdown","metadata":{"id":"qUMXT09YsNk_"},"source":["# **Estadísticas Básicas y Entendimiento del set de datos**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1607,"status":"ok","timestamp":1655574756169,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"rcfKWfrG7B_1","outputId":"8677bb39-3383-4ba9-d03c-f2fefc1235d4"},"outputs":[{"data":{"text/plain":["customer_id     0\n","account_id      0\n","device_type    29\n","asset_id       22\n","tunein          0\n","tuneout         0\n","resume          0\n","dtype: int64"]},"execution_count":25,"metadata":{},"output_type":"execute_result"}],"source":["#vemos  columnas con valores nulos\n","vistas.isnull().sum()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":6201,"status":"ok","timestamp":1655574762366,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"9d1nG4UVszK_","outputId":"c7c2ba70-fc0f-4400-c596-d636e3714fac"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-605a82c7-0152-4ed9-a0dd-47b12630c4a2\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>count</th>\n","      <th>unique</th>\n","      <th>top</th>\n","      <th>freq</th>\n","      <th>mean</th>\n","      <th>std</th>\n","      <th>min</th>\n","      <th>25%</th>\n","      <th>50%</th>\n","      <th>75%</th>\n","      <th>max</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>customer_id</th>\n","      <td>3657801.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>56974.594018</td>\n","      <td>30906.773184</td>\n","      <td>0.0</td>\n","      <td>31687.0</td>\n","      <td>57595.0</td>\n","      <td>82502.0</td>\n","      <td>112339.0</td>\n","    </tr>\n","    <tr>\n","      <th>account_id</th>\n","      <td>3657801.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>59026.510687</td>\n","      <td>32375.358934</td>\n","      <td>0.0</td>\n","      <td>31422.0</td>\n","      <td>60782.0</td>\n","      <td>87524.0</td>\n","      <td>113880.0</td>\n","    </tr>\n","    <tr>\n","      <th>device_type</th>\n","      <td>3657772.0</td>\n","      <td>5</td>\n","      <td>STB</td>\n","      <td>2993554</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>asset_id</th>\n","      <td>3657779.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>16672.216401</td>\n","      <td>9666.4945</td>\n","      <td>0.0</td>\n","      <td>8318.0</td>\n","      <td>16419.0</td>\n","      <td>25128.0</td>\n","      <td>33143.0</td>\n","    </tr>\n","    <tr>\n","      <th>tunein</th>\n","      <td>3657801.0</td>\n","      <td>128267</td>\n","      <td>2021-03-21 20:58:00.0</td>\n","      <td>284</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>tuneout</th>\n","      <td>3657801.0</td>\n","      <td>128552</td>\n","      <td>2021-03-21 20:58:00.0</td>\n","      <td>131</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>resume</th>\n","      <td>3657801.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>0.400567</td>\n","      <td>0.490013</td>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","      <td>0.0</td>\n","      <td>1.0</td>\n","      <td>1.0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-605a82c7-0152-4ed9-a0dd-47b12630c4a2')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-605a82c7-0152-4ed9-a0dd-47b12630c4a2 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-605a82c7-0152-4ed9-a0dd-47b12630c4a2');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["                 count  unique                    top     freq          mean  \\\n","customer_id  3657801.0                                          56974.594018   \n","account_id   3657801.0                                          59026.510687   \n","device_type  3657772.0       5                    STB  2993554                 \n","asset_id     3657779.0                                          16672.216401   \n","tunein       3657801.0  128267  2021-03-21 20:58:00.0      284                 \n","tuneout      3657801.0  128552  2021-03-21 20:58:00.0      131                 \n","resume       3657801.0                                              0.400567   \n","\n","                      std  min      25%      50%      75%       max  \n","customer_id  30906.773184  0.0  31687.0  57595.0  82502.0  112339.0  \n","account_id   32375.358934  0.0  31422.0  60782.0  87524.0  113880.0  \n","device_type                                                          \n","asset_id        9666.4945  0.0   8318.0  16419.0  25128.0   33143.0  \n","tunein                                                               \n","tuneout                                                              \n","resume           0.490013  0.0      0.0      0.0      1.0       1.0  "]},"execution_count":26,"metadata":{},"output_type":"execute_result"}],"source":["#entendemos las distribuciones \n","vistas.describe(include='all').T.fillna('')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":9,"status":"ok","timestamp":1655574762367,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"oTYluhe2tXIP","outputId":"46d5cb70-611b-4c56-889b-ff996449b164"},"outputs":[{"name":"stdout","output_type":"stream","text":["<class 'pandas.core.frame.DataFrame'>\n","RangeIndex: 3657801 entries, 0 to 3657800\n","Data columns (total 7 columns):\n"," #   Column       Dtype  \n","---  ------       -----  \n"," 0   customer_id  int64  \n"," 1   account_id   int64  \n"," 2   device_type  object \n"," 3   asset_id     float64\n"," 4   tunein       object \n"," 5   tuneout      object \n"," 6   resume       int64  \n","dtypes: float64(1), int64(3), object(3)\n","memory usage: 195.3+ MB\n"]}],"source":["#vemos cuales son los tipos de columnas\n","vistas.info()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":9906,"status":"ok","timestamp":1655574772266,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"ezXrmCIivPm3","outputId":"7fd62b4e-85b0-4182-ac4e-d09878c45c2f"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-3bef484d-6a8d-4d0d-9750-6b94808b0545\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>customer_id</th>\n","      <th>account_id</th>\n","      <th>device_type</th>\n","      <th>asset_id</th>\n","      <th>tunein</th>\n","      <th>tuneout</th>\n","      <th>resume</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>237465</th>\n","      <td>8378</td>\n","      <td>32671</td>\n","      <td>STB</td>\n","      <td>23997.0</td>\n","      <td>2021-01-10 22:34:00.0</td>\n","      <td>2021-01-10 22:49:00.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>237466</th>\n","      <td>8378</td>\n","      <td>32671</td>\n","      <td>STB</td>\n","      <td>23997.0</td>\n","      <td>2021-01-10 22:34:00.0</td>\n","      <td>2021-01-10 22:49:00.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>237467</th>\n","      <td>8378</td>\n","      <td>32671</td>\n","      <td>STB</td>\n","      <td>732.0</td>\n","      <td>2021-01-10 22:51:00.0</td>\n","      <td>2021-01-10 23:08:00.0</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>237468</th>\n","      <td>8378</td>\n","      <td>32671</td>\n","      <td>STB</td>\n","      <td>732.0</td>\n","      <td>2021-01-10 22:51:00.0</td>\n","      <td>2021-01-10 23:08:00.0</td>\n","      <td>1</td>\n","    </tr>\n","    <tr>\n","      <th>581736</th>\n","      <td>20613</td>\n","      <td>42632</td>\n","      <td>PHONE</td>\n","      <td>16882.0</td>\n","      <td>2021-01-10 19:18:00.0</td>\n","      <td>2021-01-10 19:23:00.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>2939847</th>\n","      <td>86771</td>\n","      <td>108753</td>\n","      <td>PHONE</td>\n","      <td>13446.0</td>\n","      <td>2021-03-18 01:25:00.0</td>\n","      <td>2021-03-18 01:49:00.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3113329</th>\n","      <td>92781</td>\n","      <td>44020</td>\n","      <td>STB</td>\n","      <td>11380.0</td>\n","      <td>2021-01-08 11:05:00.0</td>\n","      <td>2021-01-08 11:16:00.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3113330</th>\n","      <td>92781</td>\n","      <td>44020</td>\n","      <td>STB</td>\n","      <td>11380.0</td>\n","      <td>2021-01-08 11:05:00.0</td>\n","      <td>2021-01-08 11:16:00.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3461735</th>\n","      <td>105205</td>\n","      <td>20556</td>\n","      <td>STB</td>\n","      <td>16517.0</td>\n","      <td>2021-03-17 17:32:00.0</td>\n","      <td>2021-03-17 17:35:00.0</td>\n","      <td>0</td>\n","    </tr>\n","    <tr>\n","      <th>3461736</th>\n","      <td>105205</td>\n","      <td>20556</td>\n","      <td>STB</td>\n","      <td>16517.0</td>\n","      <td>2021-03-17 17:32:00.0</td>\n","      <td>2021-03-17 17:35:00.0</td>\n","      <td>0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>76 rows × 7 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-3bef484d-6a8d-4d0d-9750-6b94808b0545')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-3bef484d-6a8d-4d0d-9750-6b94808b0545 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-3bef484d-6a8d-4d0d-9750-6b94808b0545');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["         customer_id  account_id device_type  asset_id                 tunein  \\\n","237465          8378       32671         STB   23997.0  2021-01-10 22:34:00.0   \n","237466          8378       32671         STB   23997.0  2021-01-10 22:34:00.0   \n","237467          8378       32671         STB     732.0  2021-01-10 22:51:00.0   \n","237468          8378       32671         STB     732.0  2021-01-10 22:51:00.0   \n","581736         20613       42632       PHONE   16882.0  2021-01-10 19:18:00.0   \n","...              ...         ...         ...       ...                    ...   \n","2939847        86771      108753       PHONE   13446.0  2021-03-18 01:25:00.0   \n","3113329        92781       44020         STB   11380.0  2021-01-08 11:05:00.0   \n","3113330        92781       44020         STB   11380.0  2021-01-08 11:05:00.0   \n","3461735       105205       20556         STB   16517.0  2021-03-17 17:32:00.0   \n","3461736       105205       20556         STB   16517.0  2021-03-17 17:32:00.0   \n","\n","                       tuneout  resume  \n","237465   2021-01-10 22:49:00.0       0  \n","237466   2021-01-10 22:49:00.0       0  \n","237467   2021-01-10 23:08:00.0       1  \n","237468   2021-01-10 23:08:00.0       1  \n","581736   2021-01-10 19:23:00.0       0  \n","...                        ...     ...  \n","2939847  2021-03-18 01:49:00.0       0  \n","3113329  2021-01-08 11:16:00.0       0  \n","3113330  2021-01-08 11:16:00.0       0  \n","3461735  2021-03-17 17:35:00.0       0  \n","3461736  2021-03-17 17:35:00.0       0  \n","\n","[76 rows x 7 columns]"]},"execution_count":28,"metadata":{},"output_type":"execute_result"}],"source":["#detectamos filas duplicadas\n","vistas[vistas.duplicated(keep=False)]"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1655574772266,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"Jo87AAPnt7BO","outputId":"565c541a-ffbc-4fa6-ebd2-758e4d2193d6"},"outputs":[{"data":{"text/plain":["asset_id                  0\n","content_id               21\n","title                     0\n","reduced_title             0\n","episode_title          4147\n","show_type                 4\n","released_year             0\n","country_of_origin         4\n","category                  0\n","keywords                  2\n","description               2\n","reduced_desc              0\n","cast_first_name        8732\n","credits_first_name    12554\n","run_time_min              0\n","audience                  1\n","made_for_tv               0\n","close_caption             0\n","sex_rating                0\n","violence_rating           0\n","language_rating           0\n","dialog_rating             0\n","fv_rating                 0\n","pay_per_view              0\n","pack_premium_1            0\n","pack_premium_2            0\n","create_date               0\n","modify_date               0\n","start_vod_date            0\n","end_vod_date              0\n","dtype: int64"]},"execution_count":29,"metadata":{},"output_type":"execute_result"}],"source":["#repetimos los mismos pasos para el set de activos\n","activos.isnull().sum()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1011,"status":"ok","timestamp":1655574773272,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"9qN5zehOuDx2","outputId":"8526c4a2-3a41-43e6-d63d-f4506514e2c7"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-7dce77c1-66c8-44be-ba9d-239278d88629\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>count</th>\n","      <th>unique</th>\n","      <th>top</th>\n","      <th>freq</th>\n","      <th>mean</th>\n","      <th>std</th>\n","      <th>min</th>\n","      <th>25%</th>\n","      <th>50%</th>\n","      <th>75%</th>\n","      <th>max</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>asset_id</th>\n","      <td>33144.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>16571.5</td>\n","      <td>9567.992997</td>\n","      <td>0.0</td>\n","      <td>8285.75</td>\n","      <td>16571.5</td>\n","      <td>24857.25</td>\n","      <td>33143.0</td>\n","    </tr>\n","    <tr>\n","      <th>content_id</th>\n","      <td>33123.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>1371.500891</td>\n","      <td>1153.024487</td>\n","      <td>0.0</td>\n","      <td>387.0</td>\n","      <td>1019.0</td>\n","      <td>2160.0</td>\n","      <td>4371.0</td>\n","    </tr>\n","    <tr>\n","      <th>title</th>\n","      <td>33144.0</td>\n","      <td>28587</td>\n","      <td>Star Trek: En la oscuridad</td>\n","      <td>8</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>reduced_title</th>\n","      <td>33144.0</td>\n","      <td>28280</td>\n","      <td>Un_misterio_para_Au</td>\n","      <td>18</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>episode_title</th>\n","      <td>28997.0</td>\n","      <td>15773</td>\n","      <td>Episodio 1</td>\n","      <td>328</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>show_type</th>\n","      <td>33140.0</td>\n","      <td>8</td>\n","      <td>TV</td>\n","      <td>15681</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>released_year</th>\n","      <td>33144.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>2016.003922</td>\n","      <td>6.026482</td>\n","      <td>1942.0</td>\n","      <td>2015.0</td>\n","      <td>2018.0</td>\n","      <td>2019.0</td>\n","      <td>2021.0</td>\n","    </tr>\n","    <tr>\n","      <th>country_of_origin</th>\n","      <td>33140.0</td>\n","      <td>56</td>\n","      <td>US</td>\n","      <td>13583</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>category</th>\n","      <td>33144.0</td>\n","      <td>221</td>\n","      <td>Infantil/Dibujos Animados</td>\n","      <td>5491</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>keywords</th>\n","      <td>33142.0</td>\n","      <td>4450</td>\n","      <td>Actualidad,Periodístico,Política</td>\n","      <td>735</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>description</th>\n","      <td>33142.0</td>\n","      <td>20738</td>\n","      <td>Eylül fue abusada por su padrastro, pero su ma...</td>\n","      <td>430</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>reduced_desc</th>\n","      <td>33144.0</td>\n","      <td>17908</td>\n","      <td>Eylül fue abusada por su padrastro, pero su ma...</td>\n","      <td>422</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>cast_first_name</th>\n","      <td>24412.0</td>\n","      <td>4301</td>\n","      <td>İpek Karapınar, Özgür Çevik, Biran Damla Yılma...</td>\n","      <td>356</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>credits_first_name</th>\n","      <td>20590.0</td>\n","      <td>3259</td>\n","      <td>Serkan Birinci</td>\n","      <td>430</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>run_time_min</th>\n","      <td>33144.0</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td>48.060916</td>\n","      <td>35.214128</td>\n","      <td>0.0</td>\n","      <td>22.0</td>\n","      <td>43.0</td>\n","      <td>67.0</td>\n","      <td>308.0</td>\n","    </tr>\n","    <tr>\n","      <th>audience</th>\n","      <td>33143.0</td>\n","      <td>10</td>\n","      <td>General</td>\n","      <td>13658</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>made_for_tv</th>\n","      <td>33144.0</td>\n","      <td>2</td>\n","      <td>N</td>\n","      <td>32707</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>close_caption</th>\n","      <td>33144.0</td>\n","      <td>1</td>\n","      <td>N</td>\n","      <td>33144</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>sex_rating</th>\n","      <td>33144.0</td>\n","      <td>1</td>\n","      <td>N</td>\n","      <td>33144</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>violence_rating</th>\n","      <td>33144.0</td>\n","      <td>1</td>\n","      <td>N</td>\n","      <td>33144</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>language_rating</th>\n","      <td>33144.0</td>\n","      <td>1</td>\n","      <td>N</td>\n","      <td>33144</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>dialog_rating</th>\n","      <td>33144.0</td>\n","      <td>1</td>\n","      <td>N</td>\n","      <td>33144</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>fv_rating</th>\n","      <td>33144.0</td>\n","      <td>1</td>\n","      <td>N</td>\n","      <td>33144</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>pay_per_view</th>\n","      <td>33144.0</td>\n","      <td>2</td>\n","      <td>N</td>\n","      <td>32291</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>pack_premium_1</th>\n","      <td>33144.0</td>\n","      <td>2</td>\n","      <td>N</td>\n","      <td>30867</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>pack_premium_2</th>\n","      <td>33144.0</td>\n","      <td>2</td>\n","      <td>N</td>\n","      <td>31217</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>create_date</th>\n","      <td>33144.0</td>\n","      <td>33112</td>\n","      <td>2021-03-12T21:10:49.0Z</td>\n","      <td>4</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>modify_date</th>\n","      <td>33144.0</td>\n","      <td>30735</td>\n","      <td>2019-11-05T14:42:57.0Z</td>\n","      <td>4</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>start_vod_date</th>\n","      <td>33144.0</td>\n","      <td>1525</td>\n","      <td>2020-12-15T00:00:00.0Z</td>\n","      <td>2673</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","    <tr>\n","      <th>end_vod_date</th>\n","      <td>33144.0</td>\n","      <td>1377</td>\n","      <td>2020-12-14T23:59:59.0Z</td>\n","      <td>2339</td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","      <td></td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-7dce77c1-66c8-44be-ba9d-239278d88629')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-7dce77c1-66c8-44be-ba9d-239278d88629 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-7dce77c1-66c8-44be-ba9d-239278d88629');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["                      count unique  \\\n","asset_id            33144.0          \n","content_id          33123.0          \n","title               33144.0  28587   \n","reduced_title       33144.0  28280   \n","episode_title       28997.0  15773   \n","show_type           33140.0      8   \n","released_year       33144.0          \n","country_of_origin   33140.0     56   \n","category            33144.0    221   \n","keywords            33142.0   4450   \n","description         33142.0  20738   \n","reduced_desc        33144.0  17908   \n","cast_first_name     24412.0   4301   \n","credits_first_name  20590.0   3259   \n","run_time_min        33144.0          \n","audience            33143.0     10   \n","made_for_tv         33144.0      2   \n","close_caption       33144.0      1   \n","sex_rating          33144.0      1   \n","violence_rating     33144.0      1   \n","language_rating     33144.0      1   \n","dialog_rating       33144.0      1   \n","fv_rating           33144.0      1   \n","pay_per_view        33144.0      2   \n","pack_premium_1      33144.0      2   \n","pack_premium_2      33144.0      2   \n","create_date         33144.0  33112   \n","modify_date         33144.0  30735   \n","start_vod_date      33144.0   1525   \n","end_vod_date        33144.0   1377   \n","\n","                                                                  top   freq  \\\n","asset_id                                                                       \n","content_id                                                                     \n","title                                      Star Trek: En la oscuridad      8   \n","reduced_title                                     Un_misterio_para_Au     18   \n","episode_title                                              Episodio 1    328   \n","show_type                                                          TV  15681   \n","released_year                                                                  \n","country_of_origin                                                  US  13583   \n","category                                    Infantil/Dibujos Animados   5491   \n","keywords                             Actualidad,Periodístico,Política    735   \n","description         Eylül fue abusada por su padrastro, pero su ma...    430   \n","reduced_desc        Eylül fue abusada por su padrastro, pero su ma...    422   \n","cast_first_name     İpek Karapınar, Özgür Çevik, Biran Damla Yılma...    356   \n","credits_first_name                                     Serkan Birinci    430   \n","run_time_min                                                                   \n","audience                                                      General  13658   \n","made_for_tv                                                         N  32707   \n","close_caption                                                       N  33144   \n","sex_rating                                                          N  33144   \n","violence_rating                                                     N  33144   \n","language_rating                                                     N  33144   \n","dialog_rating                                                       N  33144   \n","fv_rating                                                           N  33144   \n","pay_per_view                                                        N  32291   \n","pack_premium_1                                                      N  30867   \n","pack_premium_2                                                      N  31217   \n","create_date                                    2021-03-12T21:10:49.0Z      4   \n","modify_date                                    2019-11-05T14:42:57.0Z      4   \n","start_vod_date                                 2020-12-15T00:00:00.0Z   2673   \n","end_vod_date                                   2020-12-14T23:59:59.0Z   2339   \n","\n","                           mean          std     min      25%      50%  \\\n","asset_id                16571.5  9567.992997     0.0  8285.75  16571.5   \n","content_id          1371.500891  1153.024487     0.0    387.0   1019.0   \n","title                                                                    \n","reduced_title                                                            \n","episode_title                                                            \n","show_type                                                                \n","released_year       2016.003922     6.026482  1942.0   2015.0   2018.0   \n","country_of_origin                                                        \n","category                                                                 \n","keywords                                                                 \n","description                                                              \n","reduced_desc                                                             \n","cast_first_name                                                          \n","credits_first_name                                                       \n","run_time_min          48.060916    35.214128     0.0     22.0     43.0   \n","audience                                                                 \n","made_for_tv                                                              \n","close_caption                                                            \n","sex_rating                                                               \n","violence_rating                                                          \n","language_rating                                                          \n","dialog_rating                                                            \n","fv_rating                                                                \n","pay_per_view                                                             \n","pack_premium_1                                                           \n","pack_premium_2                                                           \n","create_date                                                              \n","modify_date                                                              \n","start_vod_date                                                           \n","end_vod_date                                                             \n","\n","                         75%      max  \n","asset_id            24857.25  33143.0  \n","content_id            2160.0   4371.0  \n","title                                  \n","reduced_title                          \n","episode_title                          \n","show_type                              \n","released_year         2019.0   2021.0  \n","country_of_origin                      \n","category                               \n","keywords                               \n","description                            \n","reduced_desc                           \n","cast_first_name                        \n","credits_first_name                     \n","run_time_min            67.0    308.0  \n","audience                               \n","made_for_tv                            \n","close_caption                          \n","sex_rating                             \n","violence_rating                        \n","language_rating                        \n","dialog_rating                          \n","fv_rating                              \n","pay_per_view                           \n","pack_premium_1                         \n","pack_premium_2                         \n","create_date                            \n","modify_date                            \n","start_vod_date                         \n","end_vod_date                           "]},"execution_count":30,"metadata":{},"output_type":"execute_result"}],"source":["activos.describe(include='all').T.fillna('')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":17,"status":"ok","timestamp":1655574773273,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"rkSg3WAju0CG","outputId":"248ba607-2645-4655-dd42-6c1f98007d64"},"outputs":[{"name":"stdout","output_type":"stream","text":["<class 'pandas.core.frame.DataFrame'>\n","RangeIndex: 33144 entries, 0 to 33143\n","Data columns (total 30 columns):\n"," #   Column              Non-Null Count  Dtype  \n","---  ------              --------------  -----  \n"," 0   asset_id            33144 non-null  int64  \n"," 1   content_id          33123 non-null  float64\n"," 2   title               33144 non-null  object \n"," 3   reduced_title       33144 non-null  object \n"," 4   episode_title       28997 non-null  object \n"," 5   show_type           33140 non-null  object \n"," 6   released_year       33144 non-null  float64\n"," 7   country_of_origin   33140 non-null  object \n"," 8   category            33144 non-null  object \n"," 9   keywords            33142 non-null  object \n"," 10  description         33142 non-null  object \n"," 11  reduced_desc        33144 non-null  object \n"," 12  cast_first_name     24412 non-null  object \n"," 13  credits_first_name  20590 non-null  object \n"," 14  run_time_min        33144 non-null  float64\n"," 15  audience            33143 non-null  object \n"," 16  made_for_tv         33144 non-null  object \n"," 17  close_caption       33144 non-null  object \n"," 18  sex_rating          33144 non-null  object \n"," 19  violence_rating     33144 non-null  object \n"," 20  language_rating     33144 non-null  object \n"," 21  dialog_rating       33144 non-null  object \n"," 22  fv_rating           33144 non-null  object \n"," 23  pay_per_view        33144 non-null  object \n"," 24  pack_premium_1      33144 non-null  object \n"," 25  pack_premium_2      33144 non-null  object \n"," 26  create_date         33144 non-null  object \n"," 27  modify_date         33144 non-null  object \n"," 28  start_vod_date      33144 non-null  object \n"," 29  end_vod_date        33144 non-null  object \n","dtypes: float64(3), int64(1), object(26)\n","memory usage: 7.6+ MB\n"]}],"source":["activos.info()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":606,"status":"ok","timestamp":1655574773871,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"Q6BCk93Uw-S-","outputId":"c75b96ec-c0b4-45a5-d19b-a90115722078"},"outputs":[{"data":{"text/html":["\n","  <div id=\"df-51b6cd7e-e8a1-4097-8e5e-c2ee4dbecbe1\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>asset_id</th>\n","      <th>content_id</th>\n","      <th>title</th>\n","      <th>reduced_title</th>\n","      <th>episode_title</th>\n","      <th>show_type</th>\n","      <th>released_year</th>\n","      <th>country_of_origin</th>\n","      <th>category</th>\n","      <th>keywords</th>\n","      <th>...</th>\n","      <th>language_rating</th>\n","      <th>dialog_rating</th>\n","      <th>fv_rating</th>\n","      <th>pay_per_view</th>\n","      <th>pack_premium_1</th>\n","      <th>pack_premium_2</th>\n","      <th>create_date</th>\n","      <th>modify_date</th>\n","      <th>start_vod_date</th>\n","      <th>end_vod_date</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","  </tbody>\n","</table>\n","<p>0 rows × 30 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-51b6cd7e-e8a1-4097-8e5e-c2ee4dbecbe1')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-51b6cd7e-e8a1-4097-8e5e-c2ee4dbecbe1 button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-51b6cd7e-e8a1-4097-8e5e-c2ee4dbecbe1');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "],"text/plain":["Empty DataFrame\n","Columns: [asset_id, content_id, title, reduced_title, episode_title, show_type, released_year, country_of_origin, category, keywords, description, reduced_desc, cast_first_name, credits_first_name, run_time_min, audience, made_for_tv, close_caption, sex_rating, violence_rating, language_rating, dialog_rating, fv_rating, pay_per_view, pack_premium_1, pack_premium_2, create_date, modify_date, start_vod_date, end_vod_date]\n","Index: []\n","\n","[0 rows x 30 columns]"]},"execution_count":32,"metadata":{},"output_type":"execute_result"}],"source":["activos[activos.duplicated(keep=False,subset=['asset_id','content_id','title','reduced_title','episode_title'])]"]},{"cell_type":"markdown","metadata":{"id":"eyi-r8zMxmCN"},"source":["# **Definiciòn y Alcance**\n"]},{"cell_type":"markdown","metadata":{"id":"3_1c9tLtx-70"},"source":["El objetivo de este proyecto es crear un modelo de recomendación de titulos de peliculas, series, programas de tv y documentales para usuarios recurrentes de la plataforma"]},{"cell_type":"markdown","metadata":{"id":"ncStzvwYy1pt"},"source":["# **Análisis bivariado y multivariado de columnas del set de datos**"]},{"cell_type":"markdown","source":["https://colab.research.google.com/drive/11t0kAJKyuR0KMeB2Qoh3bB5dNU_LwPO3?usp=sharing\n"],"metadata":{"id":"CYMRXtD2F9t5"}},{"cell_type":"markdown","metadata":{"id":"uQ2KJgVUzAmE"},"source":["# **Limpieza del data set**"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"3ixtsFCXzKS0"},"outputs":[],"source":["#Eliminamos duplicados del set vistas\n","vistasLimpio=vistas.drop_duplicates()\n","#sacamos NaN\n","vistasLimpio=vistasLimpio.dropna()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"H2fQV7Xx86na"},"outputs":[],"source":["def convierteEntero(x):\n","  try:\n","    return int(x)\n","  except:\n","    return 0"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"EheArH8jzlBd"},"outputs":[],"source":["#creamos columna para saber cuantos minutos vio el activo\n","vistasLimpio.tunein=pd.to_datetime(vistasLimpio.tunein)\n","vistasLimpio.tuneout=pd.to_datetime(vistasLimpio.tuneout)\n","vistasLimpio['duration_time_hours']=vistasLimpio.tuneout- vistasLimpio.tunein \n","vistasLimpio['duration_time_minutes']=(vistasLimpio.duration_time_hours.dt.seconds/60)\n","#preparamos set para pegarle etuqueta de contenido\n","vistasLimpio['asset_id']=vistasLimpio['asset_id'].apply(convierteEntero)\n","vistasLimpio=vistasLimpio.set_index('asset_id')\n","#pegamos cotent_id\n","vistasLimpio=vistasLimpio.join(((activos[['asset_id','content_id','title']].groupby(by=['content_id','asset_id'],as_index=False)['title'].count())[['asset_id','content_id']]).set_index('asset_id'),how='left')\n","#sacamos visualizaciones a las que no le podemos asociar un contenido\n","vistasLimpio=vistasLimpio.dropna()\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-4GWrx_p7FDU"},"outputs":[],"source":["#veamos ahora el set de activos, en este, no tenemos valores duplicados\n","#nos quedamos directamente con las columnas que no son de tipo texto, ya que \n","#las features de interes para el modelo de recomendacion tienen que ser numericas o dummies\n","activosLimpo=activos[['content_id','show_type', 'released_year', 'country_of_origin', 'category',\n","                     'run_time_min', 'audience', 'made_for_tv',\n","       'close_caption', 'sex_rating', 'violence_rating', 'language_rating',\n","       'dialog_rating', 'fv_rating', 'pay_per_view', 'pack_premium_1',\n","       'pack_premium_2' ]]\n","#sacamos nulos del set de datos,ya que no solo son pocos, sino que los content_id nulos no podran ser asociados a vistas \n","activosLimpo=activosLimpo.dropna()\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"GFDxZegpg_L5"},"outputs":[],"source":["def cambiaBinario(x):\n","  if x=='Y':\n","    return 1\n","  else:\n","    return 0"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eIeXY_Rug_0R"},"outputs":[],"source":["#transformamos a binarios columna descriptivas de atributos de activos\n","for i in ['made_for_tv','close_caption', 'sex_rating', 'violence_rating', 'language_rating',\n","       'dialog_rating', 'fv_rating', 'pay_per_view', 'pack_premium_1',\n","       'pack_premium_2']:\n","       activosLimpo.loc[:,i]=activosLimpo.loc[:,i].apply(cambiaBinario)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"hFE8qLnTV0v8"},"outputs":[],"source":["#obtenemos variables dummies de columna categoty\n","temporal=activosLimpo['category'].str.split('/',expand=True).fillna('sinCategoria').reset_index()\n","temporal=((pd.get_dummies((temporal[['index',0]].append(temporal[['index',1]].rename(columns={1:0}),ignore_index=True)),drop_first=True)).groupby(by='index',as_index=False).sum()).drop(columns='0_sinCategoria').set_index('index')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"TJcZng6Ga57l"},"outputs":[],"source":["#unimos al set de activos limpios\n","\n","activosLimpo=activosLimpo.join(temporal).drop(columns='category')\n","del temporal"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"euTipAUVZCGT"},"outputs":[],"source":["columns=list(activosLimpo.columns[activosLimpo.dtypes==object])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"QS2Nm8ZTm6uf"},"outputs":[],"source":["#buscamos dummies de las categoras\n","activosLimpo.loc[:,columns]=pd.get_dummies(activosLimpo.loc[:,columns],drop_first=True)\n","activosLimpo=activosLimpo.drop(columns=columns)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ePw9SmIQnPz3"},"outputs":[],"source":["#agrupamos atributos por mismo content_id\n","activosLimpo=activosLimpo.groupby(by='content_id').sum()"]},{"cell_type":"markdown","metadata":{"id":"m7Q1ul8HpFO-"},"source":["ahora, vamos a preparar el set activolimpio, agregandole una columna target, que sera cantidad de reproducciones por tipo de contenido, con foco en hacer una seleccion de features recursivas y quedarnos unicamente con las columnas que contribuyan a describir la misma"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"OlFY3t3Box1W"},"outputs":[],"source":["#construimos la variable target\n","temporal=vistasLimpio.groupby(by='content_id')['customer_id'].count()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"raY6scGvp86W"},"outputs":[],"source":["#unimos variable target a set de datos\n","activosLimpo=activosLimpo.join(temporal).fillna(0).rename(columns={'customer_id':'visualizaciones'})\n","del temporal"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"w5oUIJJCqfAO"},"outputs":[],"source":["from sklearn.preprocessing import StandardScaler\n","scaler = StandardScaler()  \n","X=activosLimpo.drop(columns='visualizaciones')\n","y=activosLimpo['visualizaciones']\n","X_sc = scaler.fit_transform(X)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2440,"status":"ok","timestamp":1655574803036,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"z-b5Qbu3rDGv","outputId":"7a10cc95-e1c7-460f-b661-270965f88e44"},"outputs":[{"name":"stdout","output_type":"stream","text":["Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: LightGBM in /usr/local/lib/python3.7/dist-packages (2.2.3)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from LightGBM) (1.0.2)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from LightGBM) (1.21.6)\n","Requirement already satisfied: scipy in /usr/local/lib/python3.7/dist-packages (from LightGBM) (1.4.1)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->LightGBM) (3.1.0)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->LightGBM) (1.1.0)\n"]}],"source":["#instalamos LightGBM, algoritmo que Boosting que usaremos para seleccionar features\n","!pip install LightGBM "]},{"cell_type":"code","execution_count":null,"metadata":{"id":"aHbFN1snrRZl"},"outputs":[],"source":["from sklearn.feature_selection import RFECV\n","import lightgbm as lgb\n","estimator = lgb.LGBMRegressor()\n","#aplicamos validaciòn cruzada normal ya que es una regresiòn\n","rfecv = RFECV(lgb.LGBMRegressor(), cv=4, step = 1)\n","rfecv.fit(X_sc, y)\n","\n","scoresT = pd.DataFrame()\n","scoresT[\"Attribute Name\"] = X.columns; scoresT[\"Ranking\"] = rfecv.ranking_; scoresT[\"Support\"] = rfecv.support_"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":15,"status":"ok","timestamp":1655574856052,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"g5zf4y8Br-Ql","outputId":"c4e4e05b-aa96-47b0-9f23-0139ace15ca0"},"outputs":[{"data":{"text/plain":["['released_year',\n"," 'run_time_min',\n"," 'pay_per_view',\n"," 'pack_premium_1',\n"," 'pack_premium_2',\n"," '0_Acción',\n"," '0_Animación',\n"," '0_Aventura',\n"," '0_Comedia',\n"," '0_Crimen',\n"," '0_Dibujos Animados',\n"," '0_Drama',\n"," '0_Entretenimiento',\n"," '0_Infantil',\n"," '0_Interés General',\n"," '0_Reality',\n"," '0_Romance',\n"," '0_Suspenso']"]},"execution_count":49,"metadata":{},"output_type":"execute_result"}],"source":["#visualizamos columnas con las que nos quedaremos \n","list(scoresT.loc[scoresT.Support==True,'Attribute Name'])"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Ugg47Ggfsybl"},"outputs":[],"source":["#guardamos resultado de la eliminaciòn recursiva de features\n","activosLimpo=activosLimpo.loc[:,list(scoresT.loc[scoresT.Support==True,'Attribute Name'])]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"yUY7T1zotxbu"},"outputs":[],"source":["del rfecv, X_sc,y,activosLimpo"]},{"cell_type":"markdown","metadata":{"id":"foLXgZHQyLa8"},"source":["basándonos en este análisis, nos quedaremos únicamente con estas features para armar la matriz csr, del modelo de recomendación, son released_year,\n"," run_time_min,\n","pay_per_view,\n"," pack_premium_1,\n"," pack_premium_2, y category.\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"cgSCslVxvx5N"},"outputs":[],"source":["activoscsr=activos[['content_id','released_year', 'run_time_min', 'pay_per_view', 'pack_premium_1', 'pack_premium_2','category']].dropna()\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"PyRI9a3m6E96"},"outputs":[],"source":["def binarizaNumericos(x):\n","  if x>0:\n","    return 1\n","  else:\n","    return 0"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"usgdulkbzkGV"},"outputs":[],"source":["#preparamos columnas para matriz csr\n","activoscsr=activoscsr.set_index('content_id')\n","activoscsr.released_year=activoscsr.released_year.apply(convierteEntero)\n","for i in ['pay_per_view'\t,'pack_premium_1'\t,'pack_premium_2']:\n","  activoscsr.loc[:,i]=activoscsr.loc[:,i].apply(cambiaBinario)\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"B4kloXwQ1JtD"},"outputs":[],"source":["activoscsr.run_time_min=pd.qcut(activoscsr.run_time_min,5,labels=False)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"gRQF8aRF1-c7"},"outputs":[],"source":["\n","temporal=activoscsr['category'].str.split('/',expand=True).fillna('sinCategoria').reset_index()\n","temporal=((pd.get_dummies((temporal[['content_id',0]].append(temporal[['content_id',1]].rename(columns={1:0}),ignore_index=True)),drop_first=True)).groupby(by='content_id',as_index=False).sum()).drop(columns='0_sinCategoria').set_index('content_id')\n","for i in temporal.columns:\n","  temporal.loc[:,i]=temporal.loc[:,i].apply(binarizaNumericos)\n","activoscsr=activoscsr.join(temporal).drop(columns='category')\n","del temporal"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ueta1eC829Fi"},"outputs":[],"source":["#convertimos todo a str\n","for i in activoscsr.columns:\n","  activoscsr.loc[:,i]=activoscsr.loc[:,i].astype(str)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"nsnFPPZe3fvk"},"outputs":[],"source":["activoscsr=pd.get_dummies(activoscsr)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":12,"status":"ok","timestamp":1655574858127,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"0AA2zZE33rvL","outputId":"88120b98-a5b7-4895-d731-160987d596ff"},"outputs":[{"data":{"text/plain":["(4366, 184)"]},"execution_count":59,"metadata":{},"output_type":"execute_result"}],"source":["activoscsr=activoscsr.reset_index()\n","activoscsr=activoscsr.groupby(by='content_id').sum()\n","activoscsr.shape"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"xAX2oFo04sWy"},"outputs":[],"source":["for i in activoscsr.columns:\n","  activoscsr.loc[:,i]=activoscsr.loc[:,i].apply(binarizaNumericos)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"zGio7-IW82hK"},"outputs":[],"source":["vistasLimpio=vistasLimpio.reset_index()\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"8CAVQx6I_yWx"},"outputs":[],"source":["vistasLimpio['id_unico']=vistasLimpio.customer_id.astype(str)+vistasLimpio.account_id.astype(str)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Zn4oBIcBDSqn"},"outputs":[],"source":["media=vistasLimpio['duration_time_minutes'].mean()\n","desvio=vistasLimpio['duration_time_minutes'].std()\n","def normaliza(x):\n","  return abs((x-media)/desvio)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"BVh6Vvvf__S5"},"outputs":[],"source":["vistasLimpio=vistasLimpio.rename(columns={'duration_time_minutes':'puntuacion'})\n","#separamos set de datos para testeo, nos quedamos con los registros de los primeros dos meses para entrenar el modelo y el ultimo mes para probarlo\n","test=vistasLimpio[vistasLimpio.tunein.dt.month==3]\n","#vistasLimpio=vistasLimpio[vistasLimpio.tunein.dt.month!=3]\n","#guardamos los set limpios antes del agrupamiento.\n","#vistasLimpio.to_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/vistascsrPreLim.csv')\n","#test.to_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/setTesLim.csv')\n","temporal=vistasLimpio.groupby(by='id_unico', as_index=False)['content_id'].count()\n","#nos quedamos unicamente con usuarios que visualizan al menos dos tipos de contenidos para garantizar el uso de los algoritmos \n","vistacsr=(vistasLimpio[vistasLimpio.index.isin(temporal[temporal.content_id>1].index)].groupby(by=['id_unico','content_id'],as_index=False)['puntuacion'].sum())\n","vistacsr['puntuacion']=vistacsr['puntuacion'].apply(normaliza)\n","vistacsr.puntuacion=pd.qcut(vistacsr.puntuacion,5,labels=False)\n","del temporal"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"quXHbiD7K0bx"},"outputs":[],"source":["def devuelveCampoInteracciones(a,b):\n","  return vistacsr.loc[a,b]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"guDtoBvhQsI-"},"outputs":[],"source":["def devuelveCampoInteracciones(a,b):\n","  return vistacsr.loc[a,b]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"_st3BOhmTive"},"outputs":[],"source":["vistacsr=vistacsr[vistacsr.content_id.isin(list(activoscsr.reset_index().content_id))]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"dhqPf5FWLK1a"},"outputs":[],"source":["test=test[test.content_id.isin(list(activoscsr.reset_index().content_id))]\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"ILLJBqrQzIVz"},"outputs":[],"source":["vistacsr=vistacsr[~vistacsr.index.isin(test.index)]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"emPyAr6WHpc4"},"outputs":[],"source":["activoscsr=activoscsr[activoscsr.index.isin(vistacsr.content_id)]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"idfPZQ-wcUNa"},"outputs":[],"source":["#vistacsr.to_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/vistascsrPre.csv')\n","#test.to_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/setTes.csv')\n","#activoscsr.to_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/activoscsr.csv')"]},{"cell_type":"markdown","metadata":{"id":"7tsxyvoYbtFC"},"source":["# **Entrenamiento y seleccion del modelo**"]},{"cell_type":"markdown","metadata":{"id":"TvHANU4GWoGV"},"source":["# **LightFm**"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8784,"status":"ok","timestamp":1655574923352,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"dTwoDHpQbzWa","outputId":"3d170f4e-5811-4854-e74f-44ed39013574"},"outputs":[{"name":"stdout","output_type":"stream","text":["Drive already mounted at /content/drive; to attempt to forcibly remount, call drive.mount(\"/content/drive\", force_remount=True).\n","Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n","Requirement already satisfied: lightfm in /usr/local/lib/python3.7/dist-packages (1.16)\n","Requirement already satisfied: requests in /usr/local/lib/python3.7/dist-packages (from lightfm) (2.23.0)\n","Requirement already satisfied: scikit-learn in /usr/local/lib/python3.7/dist-packages (from lightfm) (1.0.2)\n","Requirement already satisfied: numpy in /usr/local/lib/python3.7/dist-packages (from lightfm) (1.21.6)\n","Requirement already satisfied: scipy>=0.17.0 in /usr/local/lib/python3.7/dist-packages (from lightfm) (1.4.1)\n","Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (2022.6.15)\n","Requirement already satisfied: chardet<4,>=3.0.2 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (3.0.4)\n","Requirement already satisfied: idna<3,>=2.5 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (2.10)\n","Requirement already satisfied: urllib3!=1.25.0,!=1.25.1,<1.26,>=1.21.1 in /usr/local/lib/python3.7/dist-packages (from requests->lightfm) (1.24.3)\n","Requirement already satisfied: threadpoolctl>=2.0.0 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->lightfm) (3.1.0)\n","Requirement already satisfied: joblib>=0.11 in /usr/local/lib/python3.7/dist-packages (from scikit-learn->lightfm) (1.1.0)\n"]}],"source":["import pandas as pd\n","import numpy as np\n","from google.colab import drive\n","drive.mount('/content/drive')\n","!pip install lightfm\n","vistacsr=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/vistascsrPre.csv')\n","test=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/setTes.csv')\n","activoscsr=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/activoscsr.csv')\n","vistacsr=vistacsr.drop(columns='Unnamed: 0')\n","test=test.drop(columns='Unnamed: 0')#\n","#activoscsr=activoscsr.drop(columns='Unnamed: 0')"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"CMBNn7Lcii6N"},"outputs":[],"source":["activoscsr=activoscsr[activoscsr.content_id.isin(vistacsr.content_id)]\n","vistacsr=vistacsr[vistacsr.content_id.isin(activoscsr.content_id)]\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"tvd_tepMqGav"},"outputs":[],"source":["activoscsr=activoscsr.set_index('content_id')"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1058,"status":"ok","timestamp":1655574924386,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"ndM6C2bqUEuq","outputId":"e6f2196f-3ed4-4f12-b243-8df0b89ecf42"},"outputs":[{"data":{"text/plain":["<lightfm.data.Dataset at 0x7f37739b4850>"]},"execution_count":75,"metadata":{},"output_type":"execute_result"}],"source":["from lightfm.data import Dataset\n","dataset  = Dataset()\n","dataset.fit(\n","            #vistacsr.loc[:,['id_unico','content_id','puntuacion']].to_numpy()\n","            #list(vistacsr.id_unico.unique()),\n","            #list(vistacsr.content_id.unique()),\n","            #list((vistacsr.rename(columns={'duration_time_minutes':'puntuacion'})).puntuacion)\n","            users=(vistacsr.loc[x,'id_unico']  for x in vistacsr.index),\n","            items =(vistacsr.loc[x,'content_id']  for x in vistacsr.index),\n","            user_features =(vistacsr.loc[x,'puntuacion']  for x in vistacsr.index)\n","            )\n","dataset"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"10kfP0EiRH4X"},"outputs":[],"source":["activoscsr=activoscsr.reset_index()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":4,"status":"ok","timestamp":1655574924387,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"qKaqP9a9ksW2","outputId":"24b05ced-9dbb-49e0-f197-1d9c20dfe3a2"},"outputs":[{"data":{"text/plain":["(24397, 24402)"]},"execution_count":77,"metadata":{},"output_type":"execute_result"}],"source":["dataset.user_features_shape()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"bl-Pz9h3QmMf"},"outputs":[],"source":["#ahora caracteristicas\n","for column in activoscsr.drop(columns='content_id').columns:\n","  dataset.fit_partial( items=(activoscsr.loc[x,'content_id'] for x in activoscsr.index),\n","                    item_features=(activoscsr.loc[x,column] for x in activoscsr.index)\n","                    )"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":532,"status":"ok","timestamp":1655574926632,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"euC2-3-AZ0P0","outputId":"ba79df04-6495-4ae2-8be8-7b32ab0387c9"},"outputs":[{"name":"stdout","output_type":"stream","text":["<24397x505 sparse matrix of type '<class 'numpy.int32'>'\n","\twith 35839 stored elements in COOrdinate format>\n"]}],"source":["#construimos la matriz de interacciones del modelo\n","(interactions, weights) = dataset.build_interactions( vistacsr.loc[:,['id_unico','content_id','puntuacion']].to_numpy())\n","\n","print(repr(interactions))\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"sUC0adK8uZ46"},"outputs":[],"source":["#guardamos el mapeo interno del modelo, los id que le asigno a las interacciones y a las features caracteristicas.\n","mapeo=dataset.mapping()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"o8TMA1O4ndgp"},"outputs":[],"source":["#list(activoscsr.loc[1].values)\n","temporal=activoscsr.drop(columns='content_id')\n","\n"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":300,"status":"ok","timestamp":1655574926930,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"NreuklrRkQEr","outputId":"8bf3fd32-4449-4780-94e3-6e43bce94660"},"outputs":[{"name":"stdout","output_type":"stream","text":["<505x506 sparse matrix of type '<class 'numpy.float32'>'\n","\twith 1514 stored elements in Compressed Sparse Row format>\n"]}],"source":["item_features = dataset.build_item_features(((activoscsr.loc[i,'content_id'],list(activoscsr.drop(columns='content_id').loc[i].values)) for i in activoscsr.index))\n","print(repr(item_features))"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"RoAFse5so1mf"},"outputs":[],"source":["del temporal"]},{"cell_type":"markdown","source":["Este algoritmo usa el descenso del gradiente estocástico asíncrono para minimizar su función de costo."],"metadata":{"id":"CCe4DIiyGinx"}},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":27199,"status":"ok","timestamp":1655574954127,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"D4b1L2e_o53e","outputId":"10641bca-b197-48f6-e7f6-dcc3332461c9"},"outputs":[{"data":{"text/plain":["<lightfm.lightfm.LightFM at 0x7f3773413150>"]},"execution_count":84,"metadata":{},"output_type":"execute_result"}],"source":["from lightfm import LightFM\n","#no_components=la dimensionalidad de las incrustaciones latentes de características.\n","#user_alpha =penalización L2 en las funciones del usuario\n","#verbose=si imprimir mensajes de progreso.\n","#num_threads=Número de subprocesos de cómputo paralelos a utilizar\n","#loss=función de pérdida\n","model = LightFM(loss='warp',\n","                random_state=2016,\n","                learning_rate=0.90,\n","                no_components=150,\n","                user_alpha=0.000005)\n","model.fit(interactions, item_features=item_features, epochs=100,\n","                  num_threads=16, verbose=False)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":14452,"status":"ok","timestamp":1655574968577,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"ZWygW14Euk7e","outputId":"6c3dbf29-7d9f-43fb-cc61-3dd8e6a639f5"},"outputs":[{"data":{"text/plain":["0.9971803158324404"]},"execution_count":85,"metadata":{},"output_type":"execute_result"}],"source":["from lightfm.evaluation import recall_at_k\n","from lightfm.evaluation import auc_score\n","recall = recall_at_k(model, interactions,item_features=item_features,k=10).mean()\n","recall"]},{"cell_type":"markdown","metadata":{"id":"GjBUGxrtQHKy"},"source":["la librería de lightfm nos proporciona métodos para probar el modelo, el mismo nos da un Recall de 0.9971 para el conjunto de entrenamiento."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"AO9AvDsUQvpZ"},"outputs":[],"source":["from lightfm.evaluation import precision_at_k\n","precision_score_train  = precision_at_k(model, interactions,item_features=item_features).mean()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":13,"status":"ok","timestamp":1655574983681,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"r9RJq2VdSv5i","outputId":"c511bce5-12b0-4936-c521-4f8843c40164"},"outputs":[{"data":{"text/plain":["0.14637455"]},"execution_count":89,"metadata":{},"output_type":"execute_result"}],"source":["precision_score_train"]},{"cell_type":"markdown","metadata":{"id":"IkzZA92SY_hv"},"source":["la precisiòn del modelo nos da  0.14637455"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":3290,"status":"ok","timestamp":1655574986960,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"ety_7F8XQsAh","outputId":"7671c8b3-2cff-4e54-bb59-e11997677385"},"outputs":[{"data":{"text/plain":["['/content/drive/MyDrive/Data Science - TP4/datos Proyecto/lightfmEquipo3.pkl']"]},"execution_count":90,"metadata":{},"output_type":"execute_result"}],"source":["#guardamos en modelo en formato pkl\n","import joblib  \n","#model = joblib.load('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/lightfmEquipo3.pkl') # Carga del modelo.\n","#la siguiente linea guarda el modelo entrenado \n","joblib.dump(model, '/content/drive/MyDrive/Data Science - TP4/datos Proyecto/lightfmEquipo3.pkl')"]},{"cell_type":"markdown","metadata":{"id":"iwzs2G9iWvhY"},"source":["probemos el modelo ahora con el conjunto de testeo, para esto utilizaremos la métrica de mean average precision (MAP). MAP es una medida estándar para comparar  de los contenidos recomendados,cuales efectivamente consumidos. Dado un conjunto de Q recomendaciones, MAP constituye la media de la precisión promedio (average precision) de cada recomendación."]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":21,"status":"ok","timestamp":1655574986961,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"-TxiY-D953_e","outputId":"6722be16-a4dc-4665-d8f0-f7a3f6b3af0a"},"outputs":[{"data":{"text/plain":["<505x506 sparse matrix of type '<class 'numpy.float32'>'\n","\twith 1514 stored elements in Compressed Sparse Row format>"]},"execution_count":91,"metadata":{},"output_type":"execute_result"}],"source":["model.predict(1,np.arange(len(vistacsr.content_id.unique() ) ))\n","item_features"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"4bkFgyth-5oP"},"outputs":[],"source":["user_dic=mapeo[0]\n","peliculas_dic=mapeo[2]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"2geBbL0uF1mR"},"outputs":[],"source":["#nos aseguramos el el id del contenido con el que se entreno este en el conjunto de testeo\n","test=test[test.content_id.isin(activoscsr.content_id)]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"eMpoEgpvTF6u"},"outputs":[],"source":["#FUNCION que nos permite calcular el APS, average precision score\n","aps = [] # lista vacía para ir almacenando la AP de cada recomendación\n","def calculaAveragePrecision(pred,label):\n","  #for pred, label in zip(pred, labels):\n","  #print(pred, label)\n","  n = len(pred) # cantidad de elementos recomendados\n","  #print(f'n = {n}')\n","  arange = np.arange(n, dtype=np.int32) + 1. # indexamos en base 1\n","  rel_k = np.in1d(pred[:n], label) # lista de booleanos que indican la relevancia de cada ítem\n","  #print(f'ítems relevantes = {rel_k}')#hasta aqui estamos viendo que items de las predicciones fueron vistos realmente por el usuario\n","  #creamos una matriz de unos con la cantidad de aciertos, luego con esta una matriz del mismo tamaño pero \n","  #con la suma acumulada de aciertos \n","  tp = np.ones(rel_k.sum(), dtype=np.int32).cumsum() # lista con el contador de verdaderos positivos\n","  #print(f'contador de verdaderos positivos = {tp}')\n","  denom = arange[rel_k] # posiciones donde se encuentran los ítems relantes\n","  #print(f'posiciones de los ítems relevantes = {denom}')\n","  #P(k) es el promedio de la cantidad de aciertos acumuladas entre su posicion, por ejemplo#\n","  #acerto en la 1,3,5. el vector de aciertos acumulado es 1,2,3. luego el resultado del pk. luego\n","  #calculariamos el average precision ap, con este resultado, dividido entre el tamaño del vector de visualizaciones hechas\n","  #print(f\"P(k) a promediar = {[f'{x}/{int(y)}' for (x,y) in zip(tp, denom)]}\")\n","  ap = (tp / denom).sum() / len(label) # average precision\n","  #print(f'average precision = {round(ap, 3)}')\n","  aps.append(ap)\n","  #almacenamos el resultado por usuario\n","  #print('\\n')\n","  return aps"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"KkK5t-tSJjoY"},"outputs":[],"source":["for id in test[test.id_unico.isin(vistacsr.id_unico)].id_unico.unique():\n","#medimos únicamente los clientes en el conjunto de testeo que son las visualizaciones del\n","#del mes de marzo, que vieron contenidos distintos en dicho mes, y no clientes que hayan repetido contenidos iguales, \n","#ya que esto dispararía las métricas de precisión del modelo, es decir, darían altas, ya que el modelo\n","#les va a recomendar contenidos que ya vieron.\n","  if len(test[(test.id_unico==id)&(~test.content_id.isin(vistacsr[vistacsr.id_unico==id].content_id))].content_id.unique())>0:\n","    verificador=len(test[(test.id_unico==id)&(~test.content_id.isin(vistacsr[vistacsr.id_unico==id].content_id))].content_id.unique())\n","    scores = pd.Series(model.predict(user_dic[id],np.arange(len(vistacsr.content_id.unique() ) )))\n","    contenido_id=pd.Series(vistacsr.content_id.unique()).reset_index().rename(columns={'index':'fk',0:'content_id'})\n","    scores=scores.reset_index().rename(columns={'index':'fk',0:'score'})\n","    scores=scores.sort_values('score',ascending=False).merge(contenido_id,on='fk',how='inner')\n","    #scores=scores[~scores.content_id.isin(vistacsr[vistacsr.id_unico==id].content_id)]\n","    #print(id)\n","    #&(~test.content_id.isin(vistacsr[vistacsr.id_unico==id].content_id))\n","    calculaAveragePrecision(scores[scores.score>0].sort_values('score',ascending=False).content_id.unique(),test[(test.id_unico==id)].content_id.unique())"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":16,"status":"ok","timestamp":1655575319474,"user":{"displayName":"Carlos Eduardo Rodriguez Elorza","userId":"14600280955697010863"},"user_tz":180},"id":"EwHlVr5M8yui","outputId":"723a2730-8b20-4fab-c412-69f59ca1f44c"},"outputs":[{"name":"stdout","output_type":"stream","text":["mean average precision = 0.281\n"]}],"source":["#Mean Average Precision para el modelo LIGHTfm:\n","MAP = np.mean(aps)\n","print(f'mean average precision = {round(MAP, 3)}')"]},{"cell_type":"markdown","metadata":{"id":"dAKt1PB-UV-9"},"source":["En conclusión el modelo, en el conjunto de train nos da 0.281, y en el conjunto de testeo nos da  0.281. A modo de baseline, el valor de MAP que se debe superar es 0,014. Este valor se obtiene con un recomendador naïve que simplemente recomienda  contenidos más populares (en términos de la cantidad de perfiles distintos que los vieron al menos una vez)."]},{"cell_type":"markdown","metadata":{"id":"ApejdmuL6MFb"},"source":["# **SURPRISE**\n","vamos  ahora con otro algoritmo de sistemas de recomendacion, utilizando la libreria Surprise,basada en la   API de scikit-learn"]},{"cell_type":"markdown","metadata":{"id":"2iVc_GqL_Ge5"},"source":["El paquete surprise no recibe directamente un objeto DataFrame sino que tiene para parsear y leer un conjunto de datos debe hacerlo a través de dos nuevos objetos: Reader y Dataset. En Reader debemos especificar el valor mínimo y el valor máximo de los ratings y Dataset nos permite leer datos desde distintas fuentes."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"incft7Ew-76O"},"outputs":[],"source":["import pandas as pd\n","import numpy as np\n","from google.colab import drive\n","drive.mount('/content/drive')\n","!pip install surprise\n","vistacsr=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/vistascsrPreLim.csv')\n","test=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/setTesLim.csv')\n","vistacsr=vistacsr.drop(columns='Unnamed: 0')\n","vistas=pd.read_csv('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/train.csv')\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"xnM8VMCqhQJ5"},"outputs":[],"source":["from sklearn.pipeline import FeatureUnion, Pipeline\n","from sklearn.base import BaseEstimator, TransformerMixin\n","from surprise import Dataset, Reader\n","from surprise import SVD\n","from surprise.model_selection import GridSearchCV\n","from surprise import accuracy"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"KEeD38Jbhfgp"},"outputs":[],"source":["#esta clase prepara el set de entrenamiento con criterios lógicos similares al primer modelo de recomendación\n","class preparaInteraccion(BaseEstimator, TransformerMixin):\n","    def __init__(self,df=None):\n","        self.df=df\n","\n","    def fit(self,X,y=None):\n","        return X\n","    \n","    def transform(self, X=None, y=None):\n","      #necesitamos crear una matriz, donde el elemento que queremos recomendar, debe estar en el set de datos al menos en dos oportunidades\n","      #para no perder una cantidad significativa de información, se recomendaran id de títulos, no de contenidos, después estos serán traducidos a id de \n","      #contenidos para comparar con el modelo lightfm \n","      temporalO=vistacsr.copy()\n","      temporalO['idunicoDeContenido']=temporalO['content_id'].astype(int).astype(str)+temporalO['asset_id'].astype(int).astype(str)\n","      temporal=temporalO.groupby(by='id_unico',as_index=False)['idunicoDeContenido'].count()\n","      listaUser=temporal[temporal.idunicoDeContenido>1].id_unico.unique()\n","      X=(temporalO[temporalO.id_unico.isin(listaUser)])[['id_unico','idunicoDeContenido','puntuacion']]\n","      del temporalO\n","      #renombramos las columnas del set de datos\n","      X=X.rename(columns={'id_unico':'user_id', 'idunicoDeContenido':'item_id', 'puntuacion':'rating'})   \n","      return X\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"doI0f6iblpjo"},"outputs":[],"source":["#esta clase modifica el criterio de preparación del modelo, calculando las puntuaciones de los contenidos por cantidad de visualizaciones y no por tiempo \n","#consumido a nivel contenido como en el modelo de recomendación anterior\n","class preparaInteraccionYcambiamosCalculoDePuntuacion(BaseEstimator, TransformerMixin):\n","    def __init__(self,df=None):\n","        self.df=df\n","\n","    def fit(self,X,y=None):\n","        return X\n","    \n","    def transform(self, X=None, y=None):\n","      temporalO=vistacsr.copy()\n","      vistast=vistas.reset_index()\n","      vistast=vistast.dropna()\n","      vistast=vistast.groupby(by='asset_id', as_index=False)['index'].count()\n","      vistast['index']=pd.qcut(vistast.index,5,labels=False)\n","      vistast=vistast.rename(columns={'index':'nuevaPuntuacion'})\n","      vistast.asset_id=vistast.asset_id.astype(int)\n","      temporalO=temporalO.merge(vistast,on='asset_id')\n","      temporalO=temporalO.drop(columns='puntuacion')\n","      temporalO=temporalO.rename(columns={'nuevaPuntuacion':'puntuacion'})\n","      del vistast  \n","      temporalO['idunicoDeContenido']=temporalO['content_id'].astype(int).astype(str)+temporalO['asset_id'].astype(int).astype(str)\n","      temporal=temporalO.groupby(by='id_unico',as_index=False)['idunicoDeContenido'].count()\n","      listaUser=temporal[temporal.idunicoDeContenido>1].id_unico.unique()\n","      X=(temporalO[temporalO.id_unico.isin(listaUser)])[['id_unico','idunicoDeContenido','puntuacion']]\n","      del temporalO\n","      #renombramos las columnas del set de datos\n","      X=X.rename(columns={'id_unico':'user_id', 'idunicoDeContenido':'item_id', 'puntuacion':'rating'})   \n","      return X"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"K6qXeKlV3LDV"},"outputs":[],"source":["class preparamosDataset(BaseEstimator, TransformerMixin):\n","    def __init__(self,df=None):\n","        self.df=df\n","\n","    def fit(self,X=None,y=None):\n","      reader = Reader(rating_scale=(X[\"rating\"].min(),X[\"rating\"].max()))\n","      X= Dataset.load_from_df(X,reader)\n","      return X\n","\n","    def transform(self, X=None, y=None): \n","      return X"]},{"cell_type":"markdown","metadata":{"id":"P_8ogVZ-IxuS"},"source":["comenzamos a encontrar el mejor modelo que nos de las mejores metricas\n"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"mUxkBIk9kiCY"},"outputs":[],"source":["fm = preparaInteraccion()\n","pr=fm.transform(vistacsr)\n","fm = preparamosDataset()\n","pr=fm.fit(pr)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":268,"status":"ok","timestamp":1655764654784,"user":{"displayName":"felix guglielmi","userId":"14071176327310256107"},"user_tz":180},"id":"ZmQzttz45JYq","outputId":"53e7a70a-7263-420c-cb0c-4f8c9a2b1f4f"},"outputs":[{"data":{"text/plain":["<surprise.dataset.DatasetAutoFolds at 0x7fbb5e948390>"]},"execution_count":7,"metadata":{},"output_type":"execute_result"}],"source":["pr"]},{"cell_type":"markdown","metadata":{"id":"urOzjqBLG84W"},"source":["Ahora cargue SVD y GridSearchCV, ambos de surprise. Nota: GridSearchCV no está en surprise.GridSearchCV, surprise.GridSearch está deprecado."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"xayZTxiLGwd_"},"outputs":[],"source":["from surprise import SVD\n","from surprise.model_selection import GridSearchCV\n","from surprise import accuracy\n","param_grid = {'n_epochs': [5, 10], 'lr_all': [ 0.005], 'reg_all': [ 0.6]}"]},{"cell_type":"markdown","metadata":{"id":"uyYirCnWHKDv"},"source":["Genere una grilla de parámetros donde se prueben distintas combinaciones de:\n","\n","epochs: es la cantidad de pasadas sobre el dataset que hará el algoritmo empleando descenso por el gradiente\n","biased: usar parámetros de sesgo o no\n","lr_all: learning rate para todos los parámetros\n","reg_all: término de regularización para todos los parámetros (lambda)\n","Emplee GridSearchCV, SVD y el diccionario con los parámetros para probar, y entrene un modelo. Note que a GridSearchCV necesita pasarle un modelo sin instanciar. Además, setee el parámetro refit a True y con measures = [\"rmse\",\"fcp\"]"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"RIzsw8F6HCXl"},"outputs":[],"source":["gs = GridSearchCV(SVD, param_grid, measures=['fcp',\"rmse\"], cv=3, refit=True)\n","gs.fit(pr)"]},{"cell_type":"markdown","source":["fcp son factor de pares concordantes, y rmse es el error cuadratico medio"],"metadata":{"id":"20XdJHa4KDAo"}},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":271,"status":"ok","timestamp":1655765489630,"user":{"displayName":"felix guglielmi","userId":"14071176327310256107"},"user_tz":180},"id":"Q9ev3ayHtdL3","outputId":"ec813567-d1a0-4e43-d01c-d451f97119a8"},"outputs":[{"data":{"text/plain":["{'fcp': 0.0038197143510316695, 'rmse': 215.06106908665424}"]},"execution_count":10,"metadata":{},"output_type":"execute_result"}],"source":["gs.best_score"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Zrswv8esugZd"},"outputs":[],"source":["#ahora probemos como nos dan las metricas aplicando  otro metodo de preparacion de puntuaciòn \n","fm = preparaInteraccionYcambiamosCalculoDePuntuacion()\n","pr=fm.transform(vistacsr)\n","fm = preparamosDataset()\n","pr=fm.fit(pr)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"-b91sXCLu314"},"outputs":[],"source":["gst = GridSearchCV(SVD, param_grid, measures=['fcp',\"rmse\"], cv=3, refit=True)\n","gst.fit(pr)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":265,"status":"ok","timestamp":1655766369528,"user":{"displayName":"felix guglielmi","userId":"14071176327310256107"},"user_tz":180},"id":"8qnF7LNTvxr1","outputId":"f9ba5084-c9ca-4eb7-f562-afe807067aca"},"outputs":[{"data":{"text/plain":["{'fcp': 0.9490282458036637, 'rmse': 0.5676584460271114}"]},"execution_count":13,"metadata":{},"output_type":"execute_result"}],"source":["gst.best_score"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"f4kocnMFwP5p"},"outputs":[],"source":["del gs,pr,fm"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"HOkoSsdGwTqh"},"outputs":[],"source":["modelo=gst.best_estimator"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"OjFbcOUbwXaA"},"outputs":[],"source":["del gst\n"]},{"cell_type":"markdown","metadata":{"id":"6ji0Nmgwv9xB"},"source":["Claramente tenemos un error cuadratico medio y un fcp mejor en la segunda opcion de preparacion de datos, por lo cual nos quedaremos con este modelo."]},{"cell_type":"code","execution_count":null,"metadata":{"id":"fDVY4pVUWIgF"},"outputs":[],"source":["#guardamos en modelo en formato pkl\n","import joblib  \n","model = joblib.load('/content/drive/MyDrive/Data Science - TP4/datos Proyecto/SVDEquipo3.pkl') # Carga del modelo.\n","#la siguiente linea guarda el modelo entrenado \n","#joblib.dump(modelo, '/content/drive/MyDrive/Data Science - TP4/datos Proyecto/SVDEquipo3.pkl')#OJO no descomentar por que se pisa el modelo"]},{"cell_type":"markdown","metadata":{"id":"eg7176s-2izb"},"source":["redefinimos la funcion para probar el modelo"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"CttQHF_l2mSR"},"outputs":[],"source":["aps = [] # lista vacía para ir almacenando la AP de cada recomendación\n","def calculaAveragePrecision(pred,label):\n","  #for pred, label in zip(pred, labels):\n","  #print(pred, label)\n","  n = len(pred) # cantidad de elementos recomendados\n","  #print(f'n = {n}')\n","  arange = np.arange(n, dtype=np.int32) + 1. # indexamos en base 1\n","  rel_k = np.in1d(pred[:n], label) # lista de booleanos que indican la relevancia de cada ítem\n","  #print(f'ítems relevantes = {rel_k}') #hasta aquí estamos viendo qué ítems de las predicciones fueron vistos realmente por el usuario\n","  #creamos una matriz de unos con la cantidad de aciertos, luego con esta una matriz del mismo tamaño pero \n","  #con la suma acumulada de aciertos \n","  tp = np.ones(rel_k.sum(), dtype=np.int32).cumsum() # lista con el contador de verdaderos positivos\n","  #print(f'contador de verdaderos positivos = {tp}')\n","  denom = arange[rel_k] # posiciones donde se encuentran los ítems relantes\n","  #print(f'posiciones de los ítems relevantes = {denom}')\n","  #P(k) es el promedio de la cantidad de aciertos acumuladas entre su posicion, por ejemplo#\n","  #acerto en la 1,3,5. el vector de aciertos acumulado es 1,2,3. luego el resultado del pk. luego\n","  #calculariamos el average precision ap, con este resultado, dividido entre el tamaño del vector de visualizaciones hechas\n","  #print(f\"P(k) a promediar = {[f'{x}/{int(y)}' for (x,y) in zip(tp, denom)]}\")\n","  ap = (tp / denom).sum() / len(label) # average precision\n","  #print(f'average precision = {round(ap, 3)}')\n","  aps.append(ap)\n","  #almacenamos el resultado por usuario\n","  #print('\\n')\n","  return aps"]},{"cell_type":"markdown","metadata":{"id":"L2unAa4Y1sKe"},"source":["preparamos el set de test, para probar el modelo como probamos el lightfm y entender cual nos da mejores resultados"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"sic_8SNM18rR"},"outputs":[],"source":["fm = preparaInteraccionYcambiamosCalculoDePuntuacion()\n","testt=fm.transform(test)\n","fm = preparaInteraccionYcambiamosCalculoDePuntuacion()\n","train=fm.transform(vistacsr)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"GfGXvEe54w46"},"outputs":[],"source":["vistacsr['idunicoDeContenido']=vistacsr['content_id'].astype(int).astype(str)+vistacsr['asset_id'].astype(int).astype(str)"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"3gmnUglMA0Y_"},"outputs":[],"source":["test['idunicoDeContenido']=test['content_id'].astype(int).astype(str)+test['asset_id'].astype(int).astype(str)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":1520,"status":"ok","timestamp":1655766632563,"user":{"displayName":"felix guglielmi","userId":"14071176327310256107"},"user_tz":180},"id":"9qaBlK-Mht1t","outputId":"86d1bc73-db37-4e58-d2c8-a885e94f02ac"},"outputs":[{"data":{"text/plain":["array([    6273464,   197627572,   696831530, ..., 11184025658,\n","        5611374131,  9958316316])"]},"execution_count":22,"metadata":{},"output_type":"execute_result"}],"source":["#[(~train.item_id.isin(test.idunicoDeContenido.unique()))\n","train[(train.user_id.isin(test.id_unico.unique()))&(~train.item_id.isin(test.idunicoDeContenido.unique()))].user_id.unique()"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"Vha00s3bnvRb"},"outputs":[],"source":["import warnings\n","\n","def fxn():\n","    warnings.warn(\"deprecated\", DeprecationWarning)\n","\n","with warnings.catch_warnings():\n","    warnings.simplefilter(\"ignore\")\n","    fxn()"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"background_save":true},"id":"Mq6lYZD90mhB"},"outputs":[],"source":["#nos quedamos unicamente con los usuarios que el modelo pudo obtener de train\n","#for id in testt[testt.user_id.isin(train.user_id)].user_id.unique():\n","for id in train[(train.user_id.isin(test.id_unico.unique()))&(~train.item_id.isin(test.idunicoDeContenido.unique()))].user_id.unique():\n","  \n","#medimos únicamente los clientes en el conjunto de testeo que son las visualizaciones del\n","#del mes de marzo, que vieron contenidos distintos en dicho mes, y no clientes que hayan repetido contenidos iguales, \n","#ya que esto dispararía las métricas de precisión del modelo, es decir, darían altas, ya que el modelo\n","#les va a recomendar contenidos que ya vieron.\n","\n"," \n","  #if len(testt[(testt.user_id ==id)&(~testt.item_id.isin(vistacsr[vistacsr.id_unico==id].idunicoDeContenido))].item_id.unique())>0:\n","  print('entro user',id)\n","  prediccionesUser=pd.DataFrame(\n","  {\n","    'item_id':'',\n","    'score_predict':-99\n","  },index=[0]) \n","  for i in test.idunicoDeContenido.unique():\n","    prediccionesUser=prediccionesUser.append(pd.DataFrame(\n","        {\n","          'item_id': str(i) ,\n","          'score_predict': model['fcp'].predict(str(id), str(i), r_ui=4, verbose=True).est\n","      \n","        },index=[0]),ignore_index=True)\n","    \n","  prediccionesUser=prediccionesUser.sort_values('score_predict',ascending=False)#.head(60)\n","  test=test.sort_values('tunein',ascending=True)\n","  calculaAveragePrecision(prediccionesUser.item_id.unique(),test[(test.id_unico==id)].idunicoDeContenido.unique())"]},{"cell_type":"code","execution_count":null,"metadata":{"id":"loL9UPiUG8S8"},"outputs":[],"source":["#Mean Average Precision para el modelo LIGHTfmt:\n","MAP = np.mean(aps)\n","print(f'mean average precision SDV = {round(MAP, 3)}')"]},{"cell_type":"markdown","metadata":{"id":"4dW-zLTMqQFq"},"source":["en línea con el criterio de evaluación, de medir solo clientes que hayan visto contenidos nuevos y obtener las métricas, vemos que este modelo nos da un MAP de 0,001 por lo tanto el algoritmo elegido para nuestro sistema de recomendación es el lightfm ya que tiene una mejor métrica que este"]},{"cell_type":"markdown","metadata":{"id":"uP2WDDP6qIHr"},"source":["![image.png](data:image/png;base64,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)"]}],"metadata":{"colab":{"collapsed_sections":["ncStzvwYy1pt","uQ2KJgVUzAmE"],"name":"1. TP 4","provenance":[]},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}